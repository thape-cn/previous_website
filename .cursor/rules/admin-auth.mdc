---
description: Admin authentication, sessions, and access patterns
globs: app/controllers/admin/**/*.rb,app/helpers/admin/**/*.rb
---
### Admin authentication and sessions

- **Session helpers**: `Admin::SessionsHelper` defines `log_in`, `log_out`, `current_user`, `logged_in?`, `logged_in_user`.
- **Global include**: `ApplicationController` includes `Admin::SessionsHelper`.
- **Redirect policy**: All non-`/admin` requests are 301 redirected to `https://www.thape.com`.
- **Admin base controller**: `Admin::ApplicationController` sets layout `admin` and has utilities like CSV header rendering.
- **Login flow**: `Admin::SessionsController#create` authenticates `User` by email/password (`bcrypt`), logs in, and redirects to `admin_root_path`.

Guidelines:
- Protect admin actions with `before_action :logged_in_user` where needed.
- Use `current_user` instead of reading the session directly.
- For CSV exports, call `render_csv_header` before rendering.